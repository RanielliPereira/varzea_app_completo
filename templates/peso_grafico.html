<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Evolu√ß√£o de Peso</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg-color: #0a0a0a;
      --text-color: #fff;
      --accent: #00ff88;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Poppins", "Segoe UI", Roboto, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    h2 {
      font-size: 2.6rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      margin-bottom: 30px;
      color: var(--accent);
      text-align: center;
    }

    /* üìä Faixa de estat√≠sticas */
    .stats-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 25px;
      background: rgba(255, 255, 255, 0.03);
      padding: 20px 30px;
      border-radius: 20px;
      box-shadow: 0 6px 30px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(15px);
      margin-bottom: 30px;
      max-width: 900px;
      width: 100%;
    }

    .stat-box {
      text-align: center;
      flex: 1;
    }

    .stat-label {
      font-size: 0.9rem;
      color: #aaa;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--accent);
    }

    .filter-buttons {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      justify-content: center;
    }

    .filter-buttons button {
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 12px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .filter-buttons button.active,
    .filter-buttons button:hover {
      background: var(--accent);
      color: #000;
      font-weight: 600;
    }

    .chart-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      max-width: 1100px;
      margin-bottom: 20px;
    }

    .chart-container {
      background: rgba(255, 255, 255, 0.02);
      padding: 30px;
      border-radius: 24px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(15px);
      width: 100%;
      height: 500px;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: transform 0.4s ease;
    }

    .chart-container:hover { transform: scale(1.02); }

    canvas {
      max-width: 100%;
      max-height: 100%;
    }

    .btn-voltar {
      display: inline-block;
      margin-top: 25px;
      padding: 14px 26px;
      background: var(--accent);
      color: #000;
      text-decoration: none;
      border-radius: 14px;
      font-size: 1.1rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-voltar:hover {
      background: #00cc6f;
      transform: translateY(-3px);
    }

    @media (max-width: 600px) {
      h2 { font-size: 2rem; }
      .chart-container { padding: 20px; height: 400px; }
      .stats-bar {
        flex-direction: column;
        gap: 15px;
        padding: 15px 20px;
      }
    }
  </style>
</head>
<body>

  <h2>üìä Evolu√ß√£o de Peso</h2>

  <!-- üìà Faixa de estat√≠sticas -->
  <div class="stats-bar">
    <div class="stat-box">
      <div class="stat-label">Peso Atual</div>
      <div class="stat-value" id="pesoAtual">0 kg</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">Maior Peso</div>
      <div class="stat-value" id="pesoMax">0 kg</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">Menor Peso</div>
      <div class="stat-value" id="pesoMin">0 kg</div>
    </div>
  </div>

  <div class="filter-buttons">
    <button class="active" onclick="filterData('7')">√öltimos 7 dias</button>
    <button onclick="filterData('30')">√öltimos 30 dias</button>
    <button onclick="filterData('all')">Todos</button>
  </div>

  <div class="chart-wrapper">
    <div class="chart-container">
      <canvas id="pesoChart"></canvas>
    </div>
  </div>

  <a href="{{ url_for('perfil') }}" class="btn-voltar">‚¨ÖÔ∏è Voltar</a>

  <script>
    const allLabels = {{ labels|tojson }};
    const allPesos = {{ pesos|tojson }};
    const ctx = document.getElementById('pesoChart').getContext('2d');
    const pesoAtualEl = document.getElementById('pesoAtual');
    const pesoMaxEl = document.getElementById('pesoMax');
    const pesoMinEl = document.getElementById('pesoMin');

    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, '#00ff88');
    gradient.addColorStop(1, '#00b36b');

    let pesoChart;

    function updateStats(filteredPesos) {
      if (filteredPesos.length === 0) return;
      const atual = filteredPesos[filteredPesos.length - 1];
      const max = Math.max(...filteredPesos);
      const min = Math.min(...filteredPesos);
      pesoAtualEl.textContent = `${atual} kg`;
      pesoMaxEl.textContent = `${max} kg`;
      pesoMinEl.textContent = `${min} kg`;
    }

    function renderChart(filteredLabels, filteredPesos) {
      if (pesoChart) pesoChart.destroy();

      const maxValue = Math.max(...filteredPesos);
      const minValue = Math.min(...filteredPesos);

      const pointBackgroundColors = filteredPesos.map(val => {
        if (val === maxValue) return '#ff4d4d';
        if (val === minValue) return '#4da6ff';
        return '#00ff88';
      });

      pesoChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: filteredLabels,
          datasets: [{
            data: filteredPesos,
            borderColor: gradient,
            backgroundColor: 'rgba(0, 255, 136, 0.1)',
            borderWidth: 4,
            tension: 0.4,
            fill: true,
            pointRadius: 6,
            pointBackgroundColor: pointBackgroundColors,
            pointBorderColor: '#0a0a0a',
            pointHoverRadius: 8,
            pointHoverBackgroundColor: '#fff',
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            tooltip: {
              backgroundColor: '#000',
              titleColor: '#00ff88',
              bodyColor: '#fff',
              cornerRadius: 8,
              padding: 12,
              callbacks: {
                title: (ctx) => `üìÖ ${ctx[0].label}`,
                label: (ctx) => `‚öñÔ∏è ${ctx.parsed.y} kg`
              }
            },
            legend: { display: false }
          },
          scales: {
            x: {
              ticks: { color: '#ccc', font: { size: 14, weight: '600' } },
              grid: { display: false }
            },
            y: {
              beginAtZero: false,
              ticks: { color: '#777', font: { size: 14 } },
              grid: { color: 'rgba(255, 255, 255, 0.05)' }
            }
          },
          layout: { padding: 10 },
          animation: { duration: 1500, easing: 'easeOutQuart' }
        }
      });

      updateStats(filteredPesos);
    }

    function filterData(period) {
      const buttons = document.querySelectorAll('.filter-buttons button');
      buttons.forEach(btn => btn.classList.remove('active'));

      if (period === '7') buttons[0].classList.add('active');
      else if (period === '30') buttons[1].classList.add('active');
      else buttons[2].classList.add('active');

      let filteredLabels = allLabels;
      let filteredPesos = allPesos;

      if (period !== 'all') {
        const days = parseInt(period);
        filteredLabels = allLabels.slice(-days);
        filteredPesos = allPesos.slice(-days);
      }

      renderChart(filteredLabels, filteredPesos);
    }

    filterData('7');
  </script>
</body>
</html>