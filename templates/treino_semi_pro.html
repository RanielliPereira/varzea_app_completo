{% extends "base.html" %}
{% block content %}
<div class="container mx-auto p-4">
  <h2 class="text-3xl font-bold text-center mb-6 text-red-600">üî• Treino Semi-Pro ‚Äî 21 Dias</h2>
  
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="mb-4">
      {% for category, message in messages %}
        <div class="p-3 rounded-lg text-center {% if category == 'success' %}bg-green-100 text-green-700{% elif category == 'error' %}bg-red-100 text-red-700{% else %}bg-gray-100 text-gray-700{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

  <!-- Barra de progresso -->
  <div class="mb-6">
    <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
      <div id="progressBar" class="h-4 bg-red-500 transition-all duration-700 ease-out"></div>
    </div>
    <p id="progressText" class="text-center text-gray-700 mt-2 font-semibold"></p>
  </div>

  <!-- Carrossel -->
  <div id="carousel" class="relative w-full max-w-md mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden">
    {% for treino in treinos %}
    <div class="day-slide {% if loop.first %}active{% endif %} p-6">
      <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">{{ treino.titulo }}</h3>
      <ul class="list-disc list-inside text-gray-700 mb-6 space-y-2">
        {% for ex in treino.exercicios %}
        <li>{{ ex }}</li>
        {% endfor %}
      </ul>

      <div class="flex justify-center gap-4">
        {% if treino.id in feitos %}
          <button class="bg-red-600 text-white px-5 py-2 rounded-lg opacity-80 cursor-not-allowed">
            ‚úÖ Check-in feito
          </button>
        {% else %}
          <form method="POST" class="inline">
            <input type="hidden" name="dia" value="{{ treino.id }}">
            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-lg transition-all">
              Fazer Check-in
            </button>
          </form>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Indicadores -->
  <div class="flex justify-center gap-2 mt-4" id="dots">
    {% for _ in treinos %}
    <div class="dot w-3 h-3 rounded-full bg-gray-400 transition-all duration-300"></div>
    {% endfor %}
  </div>

  <!-- Controles -->
  <div class="flex justify-between items-center mt-6 max-w-md mx-auto">
    <button id="prevBtn" class="bg-gray-300 px-4 py-2 rounded-lg hover:bg-gray-400">‚¨ÖÔ∏è Anterior</button>
    <p id="dayIndicator" class="text-lg font-semibold text-gray-800"></p>
    <button id="nextBtn" class="bg-gray-300 px-4 py-2 rounded-lg hover:bg-gray-400">Pr√≥ximo ‚û°Ô∏è</button>
  </div>
</div>

<style>
body {
  background: linear-gradient(180deg, #f9fafb, #f3f4f6);
}
.day-slide {
  display: none;
  animation: fade 0.5s ease-in-out;
}
.day-slide.active {
  display: block;
}
.dot.active {
  background-color: #ef4444;
  width: 10px;
  height: 10px;
}
@keyframes fade {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

<script>
let current = 0;
const slides = document.querySelectorAll(".day-slide");
const dots = document.querySelectorAll(".dot");
const total = slides.length;
const indicator = document.getElementById("dayIndicator");
const progressBar = document.getElementById("progressBar");
const progressText = document.getElementById("progressText");
const feitos = {{ feitos|length }};

function updateSlide() {
  slides.forEach((s, i) => s.classList.toggle("active", i === current));
  dots.forEach((d, i) => d.classList.toggle("active", i === current));
  indicator.textContent = `Dia ${current + 1} de ${total}`;
  document.getElementById("prevBtn").disabled = current === 0;
  document.getElementById("nextBtn").disabled = current === total - 1;
  updateProgress();
}

function updateProgress() {
  const percent = (feitos / total) * 100;
  progressBar.style.width = percent + "%";
  progressText.textContent = `${feitos} de ${total} dias conclu√≠dos (${Math.round(percent)}%)`;
}

document.getElementById("prevBtn").addEventListener("click", () => {
  if (current > 0) current--;
  updateSlide();
});
document.getElementById("nextBtn").addEventListener("click", () => {
  if (current < total - 1) current++;
  updateSlide();
});
updateSlide();
</script>
{% endblock %}